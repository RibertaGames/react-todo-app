"use client";
import { useEffect, useState } from "react";
import { supabase } from "../lib/supabaseClient";
import { Session } from "@supabase/supabase-js";

export default function LoginPage() {
  const [session, setSession] = useState<Session | null>(null);

  type OAuthProvider =
    | "google"
    | "github"
    | "facebook"
    | "twitter"
    | "apple"
    | "discord"
    | "slack";

  useEffect(() => {
    const init = async () => {
      const {
        data: { session },
      } = await supabase.auth.getSession();
      setSession(session);
    };
    init();

    const { data: listener } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setSession(session);
      }
    );

    return () => {
      listener.subscription.unsubscribe();
    };
  }, []);

  const handleOAuthLogin = async (provider: OAuthProvider) => {
    const { error } = await supabase.auth.signInWithOAuth({ provider });
    if (error) console.error(`${provider} ログインエラー:`, error.message);
  };

  const providers = [
    {
      id: "google",
      name: "Google",
      color: "bg-red-500",
      svg: (
        <svg
          className="w-5 h-5 mr-2"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill="#4285F4"
            d="M23.64 12.2045c0-.638-.057-.9878-.355-1.4186H12v2.6819h6.44c-.128 1.076-.82 2.77-2.665 3.77l-.024.16 3.847 2.99.267.026c2.457-2.265 3.875-5.59 3.875-9.19z"
          />
          <path
            fill="#34A853"
            d="M12 24c3.24 0 5.957-.96 7.943-2.607l-3.793-2.95c-1.054.708-2.408 1.202-4.15 1.202-3.19 0-5.894-2.15-6.865-5.04l-.14.012-3.894 3.02-.051.138c1.988 3.94 6.1 6.225 10.95 6.225z"
          />
          <path
            fill="#FBBC05"
            d="M5.135 14.335a7.193 7.193 0 0 1-.37-2.335c0-.81.144-1.59.37-2.336l-.003-.156-3.9-3.02-.127.06a11.996 11.996 0 0 0 0 10.94l3.66-2.55z"
          />
          <path
            fill="#ff0000"
            d="M12 4.77c1.796 0 3.39.617 4.64 1.824l3.47-3.47C17.93 1.4 15.09 0 12 0 7.06 0 2.724 2.843.64 7.012l3.9 3.02C5.94 6.59 8.67 4.77 12 4.77z"
          />
        </svg>
      ),
    },
    {
      id: "github",
      name: "GitHub",
      color: "bg-gray-800",
      svg: (
        <svg
          className="w-5 h-5 mr-2"
          viewBox="0 0 24 24"
          fill="white"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M12 0.3C5.37 0.3 0 5.67 0 12.3c0 5.3 3.438 9.8 8.205 11.385.6.112.82-.258.82-.577v-2.234c-3.338.726-4.033-1.612-4.033-1.612-.546-1.387-1.333-1.757-1.333-1.757-1.09-.745.082-.729.082-.729 1.205.084 1.84 1.236 1.84 1.236 1.07 1.833 2.807 1.303 3.492.996.108-.775.42-1.303.762-1.602-2.665-.305-5.466-1.334-5.466-5.932 0-1.31.468-2.382 1.236-3.222-.124-.303-.536-1.523.116-3.176 0 0 1.008-.323 3.3 1.23.957-.266 1.983-.399 3.003-.403 1.02.004 2.047.137 3.006.403 2.29-1.554 3.296-1.23 3.296-1.23.655 1.653.243 2.873.12 3.176.77.84 1.235 1.912 1.235 3.222 0 4.61-2.807 5.624-5.48 5.92.432.372.816 1.104.816 2.227v3.293c0 .322.216.694.825.576C20.565 22.096 24 17.597 24 12.3c0-6.63-5.373-12-12-12z" />
        </svg>
      ),
    },
    {
      id: "facebook",
      name: "Facebook",
      color: "bg-blue-500",
      svg: (
        <svg
          className="w-5 h-5 mr-2"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <rect width="24" height="24" fill="white" rx="12" /> {/* 背景丸白 */}
          <path
            fill="#1877F2"
            d="M22.675 0h-21.35C.592 0 0 .592 0 1.326v21.348C0 23.408.592 24 1.325 24H12.82v-9.294H9.692v-3.622h3.128V8.41c0-3.1 1.894-4.788 4.659-4.788 1.325 0 2.466.099 2.796.143v3.24l-1.918.001c-1.504 0-1.796.715-1.796 1.763v2.313h3.59l-.467 3.622h-3.123V24h6.116c.73 0 1.324-.592 1.324-1.326V1.326C24 .592 23.408 0 22.675 0z"
          />
        </svg>
      ),
    },
    {
      id: "twitter",
      name: "X",
      color: "bg-black",
      svg: (
        <svg
          className="w-5 h-5 mr-2"
          viewBox="0 0 24 24"
          fill="white"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M20.33 3H16.8l-4.28 5.82L8.2 3H3.67l6.89 9.2L3.3 21h3.53l4.47-6.07L16.47 21h4.52l-7.11-9.49L20.33 3z" />
        </svg>
      ),
    },
    // {
    //   id: "apple",
    //   name: "Apple",
    //   color: "bg-black",
    //   svg: (
    //     <svg
    //       className="w-5 h-5 mr-2"
    //       viewBox="0 0 24 24"
    //       fill="none"
    //       xmlns="http://www.w3.org/2000/svg"
    //     >
    //       <path
    //         fillRule="evenodd"
    //         clipRule="evenodd"
    //         d="M16.365 1.43c0 1.14-.424 2.085-1.27 2.832-.844.745-1.797 1.182-2.86 1.305-.056-.163-.084-.38-.084-.653 0-1.077.424-1.984 1.27-2.722.846-.737 1.803-1.155 2.874-1.26.05.158.07.317.07.498zM20.278 17.562c-.522 1.21-.789 1.8-1.46 2.907-1.058 1.68-2.546 3.788-4.405 3.795-1.16.007-1.46-.757-3.037-.75-1.577.008-1.914.765-3.08.757-1.86-.007-3.31-1.92-4.37-3.6C2.44 19.4.12 14.13 2.837 10.424c.974-1.405 2.417-2.23 4.057-2.23 1.12 0 2.05.78 2.835.78.76 0 1.845-.784 3.12-.784 1.414 0 2.48.72 3.202 1.583-2.837 1.548-2.37 5.604.227 6.79z"
    //         fill="white"
    //       />
    //     </svg>
    //   ),
    // },
    {
      id: "discord",
      name: "Discord",
      color: "bg-indigo-600",
      svg: (
        <svg
          className="w-5 h-5 mr-2"
          viewBox="0 0 24 24"
          fill="#ffffff"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill="#fff"
            d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0786-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0815.0095c.1192.099.246.1981.372.2924a.0766.0766 0 01-.0064.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.106c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.082.082 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9457 2.4189-2.1569 2.4189zm7.9748 0c-1.1824 0-2.1568-1.0857-2.1568-2.419 0-1.3332.9554-2.4189 2.1568-2.4189 1.2108 0 2.1757 1.0952 2.1569 2.419 0 1.3332-.9461 2.4189-2.1569 2.4189z"
          />
        </svg>
      ),
    },
    {
      id: "slack_oidc",
      name: "Slack",
      color: "bg-purple-600",
      svg: (
        <svg
          className="w-5 h-5 mr-2"
          viewBox="0 0 32 32"
          fill="none"
          width="20"
          height="20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M26.5002 14.9996C27.8808 14.9996 29 13.8804 29 12.4998C29 11.1192 27.8807 10 26.5001 10C25.1194 10 24 11.1193 24 12.5V14.9996H26.5002ZM19.5 14.9996C20.8807 14.9996 22 13.8803 22 12.4996V5.5C22 4.11929 20.8807 3 19.5 3C18.1193 3 17 4.11929 17 5.5V12.4996C17 13.8803 18.1193 14.9996 19.5 14.9996Z"
            fill="#2EB67D"
          />
          <path
            d="M5.49979 17.0004C4.11919 17.0004 3 18.1196 3 19.5002C3 20.8808 4.1193 22 5.49989 22C6.8806 22 8 20.8807 8 19.5V17.0004H5.49979ZM12.5 17.0004C11.1193 17.0004 10 18.1197 10 19.5004V26.5C10 27.8807 11.1193 29 12.5 29C13.8807 29 15 27.8807 15 26.5V19.5004C15 18.1197 13.8807 17.0004 12.5 17.0004Z"
            fill="#E01E5A"
          />
          <path
            d="M17.0004 26.5002C17.0004 27.8808 18.1196 29 19.5002 29C20.8808 29 22 27.8807 22 26.5001C22 25.1194 20.8807 24 19.5 24L17.0004 24L17.0004 26.5002ZM17.0004 19.5C17.0004 20.8807 18.1197 22 19.5004 22L26.5 22C27.8807 22 29 20.8807 29 19.5C29 18.1193 27.8807 17 26.5 17L19.5004 17C18.1197 17 17.0004 18.1193 17.0004 19.5Z"
            fill="#ECB22E"
          />
          <path
            d="M14.9996 5.49979C14.9996 4.11919 13.8804 3 12.4998 3C11.1192 3 10 4.1193 10 5.49989C10 6.88061 11.1193 8 12.5 8L14.9996 8L14.9996 5.49979ZM14.9996 12.5C14.9996 11.1193 13.8803 10 12.4996 10L5.5 10C4.11929 10 3 11.1193 3 12.5C3 13.8807 4.11929 15 5.5 15L12.4996 15C13.8803 15 14.9996 13.8807 14.9996 12.5Z"
            fill="#36C5F0"
          />
        </svg>
      ),
    },
  ];

  if (session) {
    return <></>;
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="bg-white p-8 rounded shadow-md w-full max-w-sm">
        <h1 className="text-xl font-bold mb-4 text-gray-800">ログイン</h1>

        <hr className="my-4" />
        <div className="space-y-2">
          {providers.map((p) => (
            <button
              key={p.id}
              onClick={() => handleOAuthLogin(p.id as OAuthProvider)}
              className={`${p.color} hover:opacity-90 focus:ring-2 focus:ring-offset-2 focus:ring-${p.color} text-white w-full py-2 rounded flex items-center justify-center cursor-pointer`}
            >
              {p.svg}
              {p.name}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
}
